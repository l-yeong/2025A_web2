<?xml version="1.0" encoding="UTF-8" ?>

<!-- XML 이란? 마크업 이용한 데이터 저장(설정)/전달/교환(API) 프로그래밍언어 -->
<!-- XML : 마크업 이용한 웹페이지 마크업언어 -->

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- XML 파일내 mybatis 라이브러리 설정 -->

<!-- XML 과 매핑할 인터페이스 설정, [src] 이하 경로 지정 -->
<!-- <mapper namespace="매핑할 인터페이스 파일 경로"> -->
<mapper namespace="실습.실습5.model.mapper.BookMapper"> <!-- mapper 시작 -->

    <!-- price 추가 -->
    <update id="addPrice">
        ALTER TABLE books add column price int
    </update>
    <!-- title 타입 longtext로 변경 -->
    <update id="updateTitle">
        ALTER TABLE books modify title longtext
    </update>
    <!-- 평균재고보다 많은 도서 조회 -->
    <select id="avgBook" resultType="실습.실습5.model.dto.BookDto">
        SELECT * FROM books WHERE stock > (SELECT avg(stock) FROM books)
    </select>
    <!-- 가장많이 대출한 도서 조회 -->
    <select id="rentalBook" resultType="String">
        SELECT b.title , (SELECT count(*) FROM rentals r WHERE b.id = r.id) as total
        FROM books b order by total desc limit 0,1
    </select>

</mapper><!-- mapper 끝 -->